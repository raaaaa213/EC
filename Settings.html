<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Settings | StudyPlanner</title>
  <link rel="stylesheet" href="shared.css" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet" />
</head>
<body>
  <header class="main-header">
    <div class="clock" id="realtimeClock"></div>
    <h1>StudyPlanner</h1>
    <p class="subtitle">Customise Your Experience</p>
    <nav>
      <ul class="nav-links">
        <li><a href="index.html">Home</a></li>
        <li><a href="checkin.html">Daily Check-In</a></li>
        <li><a href="tasks.html">Task Board</a></li>
        <li><a href="dashboard.html">Dashboard</a></li>
        <li><a href="Settings.html">Settings</a></li>
      </ul>
    </nav>
  </header>

  <main class="container">
    <section class="welcome-section">
      <h2>Settings</h2>
      <p>Adjust preferences, reset data, and control appearance.</p>
    </section>

    <section class="form-card">
      <h3>Appearance</h3>
      <label for="themeSelect">Theme:</label>
      <select id="themeSelect">
        <option value="light">Light</option>
        <option value="dark">Dark</option>
      </select>
      <div style="margin-top:1rem;">
        <label for="fontSizeSelect">Font Size:</label>
        <select id="fontSizeSelect">
          <option value="normal">Normal</option>
          <option value="large">Large</option>
          <option value="xlarge">Extra Large</option>
        </select>
      </div>
    </section>

    <section class="form-card">
      <h3>Language</h3>
      <label for="languageSelect">Choose Language:</label>
      <select id="languageSelect">
        <option value="en">English</option>
        <option value="es">Español</option>
        <option value="fr">Français</option>
        <option value="zh">中文</option>
        <option value="hi">हिन्दी</option>
      </select>
    </section>

    <section class="form-card">
      <h3>Data</h3>
      <button id="exportCSV" class="btn">Export Check-ins to CSV</button>
      <button id="resetAll" class="btn danger">Reset All Data</button>
    </section>

    <section class="form-card">
      <h3>Administrator 
        <span id="adminInfoIcon" title="Administrator mode allows teachers to demo features, add check-ins for any date, and access extra controls." style="font-size:1.1em; cursor:pointer; color:#0077cc; vertical-align:middle; display:inline-block; width:1.2em; height:1.2em; z-index:2001; position:relative;">
          <svg viewBox="0 0 24 24" width="1em" height="1em" style="vertical-align:middle;">
            <circle cx="12" cy="12" r="10" fill="#eaf4fb" stroke="#0077cc" stroke-width="2"/>
            <text x="12" y="16" text-anchor="middle" font-size="12" font-family="Arial, sans-serif" fill="#0077cc" font-weight="bold">i</text>
          </svg>
        </span>
      </h3>
      <label for="adminToggle" style="display:flex; align-items:center; gap:0.5em;">
        <input type="checkbox" id="adminToggle" /> Enable Administrator Mode
      </label>
      <div id="adminFeatures" style="display:none; margin-top:1em;">
        <button id="addDemoCheckins" class="btn">Add Demo Check-Ins</button>
        <button id="addDemoTasks" class="btn">Add Demo Tasks</button>
        <!-- More admin features can be added here -->
      </div>
    </section>

    <!-- Modal for admin info -->
    <div id="adminInfoModal" class="modal" style="display:none;">
      <div class="modal-content">
        <span class="close" id="closeAdminInfoModal">&times;</span>
        <h2>Administrator Mode</h2>
        <p>Administrator mode allows teachers to demo features, add check-ins for any date (including future dates for graph testing), and access extra controls. Use this mode for demonstration and testing purposes. Changes made in admin mode may not reflect real student data.</p>
      </div>
    </div>

    <button class="page-nav-arrow left" id="prevPageBtn" title="Previous Page"><span>&#x25C0;</span></button>
    <button class="page-nav-arrow right" id="nextPageBtn" title="Next Page"><span>&#x25B6;</span></button>

  </main>

  <footer>
    <p>&copy; 2025 StudyPlanner | Settings Panel</p>
  </footer>

  <script src="settings.js"></script>
  <script src="shared.js"></script>
  <!--
    Inline script for settings page:
    - Handles i18n (translations) for UI elements
    - Manages navigation between pages
    - Controls admin info modal behavior
    - Applies dynamic text and event handlers for settings features
  -->
  <script>
// === Simple i18n for StudyPlanner (shared for all pages) ===
const translations = {
  en: {
    settingsTitle: "Settings",
    settingsSubtitle: "Adjust preferences, reset data, and control appearance.",
    appearance: "Appearance",
    darkMode: "Toggle Dark Mode",
    fontSize: "Font Size (AU):",
    language: "Language",
    chooseLanguage: "Choose Language:",
    data: "Data",
    resetAll: "Reset All Data",
    exportCSV: "Export Check-ins to CSV",
    admin: "Administrator",
    adminInfo: "Administrator mode allows teachers to demo features, add check-ins for any date, and access extra controls.",
    enableAdmin: "Enable Administrator Mode",
    addDemoCheckins: "Add Demo Check-Ins",
    addDemoTasks: "Add Demo Tasks",
    theme: "Theme",
    systemDefault: "System Default",
    lightTheme: "Light",
    darkTheme: "Dark"
  },
  es: {
    settingsTitle: "Configuración",
    settingsSubtitle: "Ajusta preferencias, restablece datos y controla la apariencia.",
    appearance: "Apariencia",
    darkMode: "Alternar modo oscuro",
    fontSize: "Tamaño de fuente:",
    language: "Idioma",
    chooseLanguage: "Elige idioma:",
    data: "Datos",
    resetAll: "Restablecer todos los datos",
    exportCSV: "Exportar registros a CSV",
    admin: "Administrador",
    adminInfo: "El modo administrador permite a los profesores demostrar funciones, agregar registros para cualquier fecha y acceder a controles adicionales.",
    enableAdmin: "Habilitar modo administrador",
    addDemoCheckins: "Agregar registros de demostración",
    addDemoTasks: "Agregar tareas de demostración",
    theme: "Tema",
    systemDefault: "Predeterminado del sistema",
    lightTheme: "Claro",
    darkTheme: "Oscuro"
  },
  fr: {
    settingsTitle: "Paramètres",
    settingsSubtitle: "Ajustez les préférences, réinitialisez les données et contrôlez l'apparence.",
    appearance: "Apparence",
    darkMode: "Basculer en mode sombre",
    fontSize: "Taille de police :",
    language: "Langue",
    chooseLanguage: "Choisir la langue :",
    data: "Données",
    resetAll: "Réinitialiser toutes les données",
    exportCSV: "Exporter les enregistrements en CSV",
    admin: "Administrateur",
    adminInfo: "Le mode administrateur permet aux enseignants de démontrer des fonctionnalités, d'ajouter des enregistrements pour n'importe quelle date et d'accéder à des contrôles supplémentaires.",
    enableAdmin: "Activer le mode administrateur",
    addDemoCheckins: "Ajouter des enregistrements de démonstration",
    addDemoTasks: "Ajouter des tâches de démonstration",
    theme: "Thème",
    systemDefault: "Défaut du système",
    lightTheme: "Clair",
    darkTheme: "Sombre"
  },
  zh: {
    settingsTitle: "设置",
    settingsSubtitle: "调整偏好、重置数据并控制外观。",
    appearance: "外观",
    darkMode: "切换深色模式",
    fontSize: "字体大小：",
    language: "语言",
    chooseLanguage: "选择语言：",
    data: "数据",
    resetAll: "重置所有数据",
    exportCSV: "导出签到到CSV",
    admin: "管理员",
    adminInfo: "管理员模式允许教师演示功能，为任何日期添加签到，并访问额外的控制选项。",
    enableAdmin: "启用管理员模式",
    addDemoCheckins: "添加演示签到",
    addDemoTasks: "添加演示任务",
    theme: "主题",
    systemDefault: "系统默认",
    lightTheme: "明亮",
    darkTheme: "黑暗"
  },
  hi: {
    settingsTitle: "सेटिंग्स",
    settingsSubtitle: "प्राथमिकताएँ समायोजित करें, डेटा रीसेट करें और रूप नियंत्रित करें।",
    appearance: "रूप",
    darkMode: "डार्क मोड टॉगल करें",
    fontSize: "फ़ॉन्ट आकार:",
    language: "भाषा",
    chooseLanguage: "भाषा चुनें:",
    data: "डेटा",
    resetAll: "सभी डेटा रीसेट करें",
    exportCSV: "चेक-इन को CSV में निर्यात करें",
    admin: "व्यवस्थापक",
    adminInfo: "व्यवस्थापक मोड शिक्षकों को सुविधाएँ प्रदर्शित करने, किसी भी तारीख के लिए चेक-इन जोड़ने और अतिरिक्त नियंत्रणों तक पहुँचने की अनुमति देता है।",
    enableAdmin: "व्यवस्थापक मोड सक्षम करें",
    addDemoCheckins: "डेमो चेक-इन जोड़ें",
    addDemoTasks: "डेमो कार्य जोड़ें",
    theme: "थीम",
    systemDefault: "सिस्टम डिफ़ॉल्ट",
    lightTheme: "हल्का",
    darkTheme: "गहरा"
  }
};
function applySettingsTranslations() {
  const lang = localStorage.getItem('language') || 'en';
  const t = translations[lang] || translations['en'];
  if(document.querySelector('.welcome-section h2'))
    document.querySelector('.welcome-section h2').textContent = t.settingsTitle;
  if(document.querySelector('.welcome-section p'))
    document.querySelector('.welcome-section p').textContent = t.settingsSubtitle;
  const cards = document.querySelectorAll('.form-card');
  if(cards.length >= 3) {
    cards[0].querySelector('h3').textContent = t.appearance;
    cards[0].querySelector('#toggleDark').textContent = t.darkMode;
    cards[0].querySelector('label[for="fontSizeSelect"]').textContent = t.fontSize;
    cards[0].querySelector('label[for="themeSelect"]').textContent = t.theme;
    cards[1].querySelector('h3').textContent = t.language;
    cards[1].querySelector('label[for="languageSelect"]').textContent = t.chooseLanguage;
    cards[2].querySelector('h3').textContent = t.data;
    cards[2].querySelector('#resetAll').textContent = t.resetAll;
    cards[2].querySelector('#exportCSV').textContent = t.exportCSV;
  }
  if(cards.length >= 4) {
    // Update admin h3 text and info icon title without replacing the SVG
    const adminLabel = cards[3].querySelector('label[for="adminToggle"]');
    if (adminLabel) {
      // Find the text node after the input and update it, or append if missing
      const input = adminLabel.querySelector('input[type="checkbox"]');
      if (input) {
        // Remove all text nodes after the input
        while (input.nextSibling) {
          adminLabel.removeChild(input.nextSibling);
        }
        adminLabel.appendChild(document.createTextNode(' ' + t.enableAdmin));
      }
    }
    if (adminH3) {
      // Find the text node and the info icon span
      const adminInfoSpan = adminH3.querySelector('#adminInfoIcon');
      // Set the text before the icon
      if (adminH3.childNodes.length > 0) {
        // If first node is a text node, update it; else insert one
        if (adminH3.childNodes[0].nodeType === Node.TEXT_NODE) {
          adminH3.childNodes[0].textContent = t.admin + " ";
        } else {
          adminH3.insertBefore(document.createTextNode(t.admin + " "), adminInfoSpan);
        }
      }
      // Update the info icon's title
      if (adminInfoSpan) {
        adminInfoSpan.title = t.adminInfo;
      }
    }
    cards[3].querySelector('label[for="adminToggle"]').textContent = t.enableAdmin;
    const adminFeatures = cards[3].querySelector('#adminFeatures');
    if(adminFeatures) {
      adminFeatures.querySelector('#addDemoCheckins').textContent = t.addDemoCheckins;
      adminFeatures.querySelector('#addDemoTasks').textContent = t.addDemoTasks;
    }
  }
  if(window.applyNavTranslations) window.applyNavTranslations();
}
document.addEventListener('DOMContentLoaded', applySettingsTranslations);
window.addEventListener('storage', applySettingsTranslations);

// Admin info modal
const adminInfoIcon = document.getElementById('adminInfoIcon');
const adminInfoModal = document.getElementById('adminInfoModal');
const closeAdminInfoModal = document.getElementById('closeAdminInfoModal');

if(adminInfoIcon) {
  adminInfoIcon.onclick = () => {
    adminInfoModal.style.display = 'block';
  }
}

// Page order for navigation
const pageOrder = [
  'index.html',
  'checkin.html',
  'tasks.html',
  'dashboard.html',
  'settings.html'
];
const currentPage = location.pathname.split('/').pop();
const prevBtn = document.getElementById('prevPageBtn');
const nextBtn = document.getElementById('nextPageBtn');
const idx = pageOrder.indexOf(currentPage);
if (prevBtn) {
  prevBtn.style.display = idx > 0 ? 'flex' : 'none';
  prevBtn.disabled = idx === 0;
  prevBtn.onclick = idx > 0 ? () => location.href = pageOrder[idx-1] : null;
}
if (nextBtn) {
  nextBtn.style.display = idx < pageOrder.length-1 ? 'flex' : 'none';
  nextBtn.disabled = idx === pageOrder.length-1;
  nextBtn.onclick = idx < pageOrder.length-1 ? () => location.href = pageOrder[idx+1] : null;
}

// Remove demo data when disabling admin mode
function removeDemoData() {
  // Remove demo checkins (identified by 'Demo reflection' in reflection field)
  let checkins = JSON.parse(localStorage.getItem('checkins') || '[]');
  checkins = checkins.filter(c => !(c.reflection && c.reflection.startsWith('Demo reflection')));
  localStorage.setItem('checkins', JSON.stringify(checkins));
  // Remove demo tasks (identified by specific demo text)
  let tasks = JSON.parse(localStorage.getItem('tasks') || '[]');
  const demoTaskNames = [
    'Finish math worksheet',
    'Read science chapter',
    'Submit history essay',
    'Practice piano',
    'Complete coding challenge'
  ];
  tasks = tasks.filter(t => !demoTaskNames.includes(t.text));
  localStorage.setItem('tasks', JSON.stringify(tasks));
}
// Attach to admin toggle if present
const adminToggle = document.getElementById('adminToggle');
if (adminToggle) {
  adminToggle.addEventListener('change', function() {
    if (!adminToggle.checked) {
      removeDemoData();
    }
  });
}

// === Theme Switcher: Instantly apply theme on change ===
const themeSelect = document.getElementById('themeSelect');
if (themeSelect) {
  themeSelect.addEventListener('change', function() {
    const theme = themeSelect.value;
    if (theme === 'dark') {
      document.body.classList.add('dark');
      localStorage.setItem('theme', 'dark');
    } else {
      document.body.classList.remove('dark');
      localStorage.setItem('theme', 'light');
    }
  });
}

// Real-time clock script
function updateClock() {
  const now = new Date();
  const options = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false };
  document.getElementById('realtimeClock').textContent = now.toLocaleTimeString('en-US', options);
}
setInterval(updateClock, 1000);
updateClock(); // initial call to set clock immediately
  </script>
  
  <style>
    .modal {
      display: none;
      position: fixed;
      z-index: 3000;
      left: 0;
      top: 0;
      width: 100vw;
      height: 100vh;
      overflow: auto;
      background-color: rgba(0,0,0,0.4);
    }
    .modal-content {
      background-color: #fff;
      margin: 10% auto;
      padding: 2em 2em 1em 2em;
      border: 1px solid #888;
      width: 90%;
      max-width: 400px;
      border-radius: 8px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.2);
      position: relative;
      text-align: left;
      z-index: 3001;
    }
    .modal-content h2 {
      margin-top: 0;
      color: #004080;
    }
    .close {
      color: #aaa;
      position: absolute;
      top: 10px;
      right: 18px;
      font-size: 2em;
      font-weight: bold;
      cursor: pointer;
      z-index: 3002;
    }
    .close:hover {
      color: #0077cc;
    }
    .clock {
      font-family: 'Consolas', 'Courier New', monospace;
      font-weight: normal;
      font-size: 1.2rem;
      color: #333;
      position: absolute;
      right: 20px;
      top: 20px;
      z-index: 2001;
      background: #bcd0e0;
      padding: 0.2em 0.8em;
      border-radius: 1.5em;
    }
  </style>
</body>
</html>
